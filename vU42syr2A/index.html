<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<meta name="referrer" content="never">
<meta name="keywords" content="">
<meta name="description" content="欢迎访问[tianxia]的个人博客">
<meta name="author" content="kveln">
<title>发布JAR包到远程中央仓库 | tianxia</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css">
<link href="https://cdn.bootcss.com/font-awesome/5.11.2/css/all.min.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
<link
  href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'
  rel='stylesheet' type='text/css'>
<link rel="alternate" type="application/rss+xml" title="发布JAR包到远程中央仓库 | tianxia » Feed"
  href="https://tianxiawuhao.github.io/atom.xml">
<link rel="stylesheet"
  href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.10/build/styles/androidstudio.min.css">
<link href="https://tianxiawuhao.github.io/styles/main.css" rel="stylesheet">
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/850552586/ericamcdn@0.1/css/live2d.css">

<script>hljs.initHighlightingOnLoad();</script>

  <meta property="og:description" content="发布JAR包到远程中央仓库" />
  <meta property="og:url" content="https://tianxiawuhao.github.io/vU42syr2A/" />
  <meta property="og:locale" content="zh-CN" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="tianxia" />
  <!-- <script src="../assets/styles/scripts/tocScript.js"></script> -->
</head>

<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="https://tianxiawuhao.github.io">tianxia</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
      data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
      aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        
        <li class="nav-item">
          
          <a class="nav-link" href="https://tianxiawuhao.github.io">首页</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/archives">归档</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/tags">标签</a>
          
        </li>
        
        <li class="nav-item">
          <div class="gridea-search-container">
            <form id="gridea-search-form" style="position: relative" data-update="1742729663519"
              action="/search/index.html">
              <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
              <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>
  <!-- Page Header -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="https://tianxiawuhao.github.io">tianxia</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
      data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
      aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        
        <li class="nav-item">
          
          <a class="nav-link" href="https://tianxiawuhao.github.io">首页</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/archives">归档</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/tags">标签</a>
          
        </li>
        
        <li class="nav-item">
          <div class="gridea-search-container">
            <form id="gridea-search-form" style="position: relative" data-update="1742729663519"
              action="/search/index.html">
              <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
              <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>
<header class="masthead" style="background-image: url('https://tianxiawuhao.github.io/media/images/home-bg.jpg')">
  <div class="overlay"></div>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        
          <!-- 没Title为其他页面Header -->
          
            <!-- 没Title并且有headerType为Post：文章Header -->
            <div class="post-heading">
              <span class="tags">
                
                <a href="https://tianxiawuhao.github.io/2mqFj7PxF/" class="tag">maven</a>
                
                <a href="https://tianxiawuhao.github.io/6l4aXFMiY/" class="tag">java</a>
                
              </span>
              <h1>发布JAR包到远程中央仓库</h1>
              <span class="meta">
                Posted on
                2022-10-26，21 min read
              </span>
            </div>
          
        
      </div>
    </div>
  </div>
</header>
  <!-- Post Content -->
  <article id="post-content-article">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto post-content-container">
          
          <img class="post-feature-header-image" src="https://tianxiawuhao.github.io/post-images/vU42syr2A.png" alt="封面图">
          </img>
          
          <p><code>声明：经过下面一系列操作之后，以后想发布新版本，只要修改好要升级的版本，然后在 Maven的 Lifecycle 里双击 deploy 即可~</code></p>
<h3 id="前言">前言</h3>
<p>自使用maven以来，没少使用maven中央仓库中的各种jar包，方便有效，但是咱们也不能总是只取不予，也应该懂得奉献，当你写好了一个十分好用的jar包，想贡献出去给大家使用的时候，应该怎么做呢？当然是发布到maven的中央仓库了，不过要说这个发布过程，还真是比较复杂，本文就来详细说下如何发布jar包到maven中央仓库。</p>
<h3 id="注意事项">注意事项</h3>
<ul>
<li><strong>工单管理</strong>：​ ​https://issues.sonatype.org/secure/Dashboard.jspa​​</li>
</ul>
<p>说明：注册账号、创建和管理issue，Jar包的发布是以解决issue的方式起步的。这里的用户名与密码是非常重要的，后面会用到，一定要保存好。</p>
<ul>
<li><strong>构件仓库</strong>：​ ​https://oss.sonatype.org/#welcome​​</li>
</ul>
<p>说明：算是正式发布前的一个过段仓库，使用maven提交后的jar包先到这个库中。</p>
<ul>
<li><strong>镜像仓库</strong>：​ ​http://search.maven.org​​</li>
</ul>
<p>说明：最终成功发布的jar可以在这里搜到。</p>
<h3 id="一-创建工单">一、创建工单</h3>
<p>在上述的​​工单管理​​​的地址中进行创建，如果没有账号，需要先注册一个，记住用户名密码，后边要配置到​​setting.xml​​中。</p>
<p>Create Issue 填写内容说明：</p>
<figure data-type="image" tabindex="1"><img src="https://tianxiawuhao.github.io/post-images/1666786672736.png" alt="" loading="lazy"></figure>
<pre><code>===Step 1===
Project：Community Support - Open Source Project Repository Hosting
Issue Type：New Project

===Step 2===
Summary：JAR包名称，如：requestjson
Group Id：你懂得，不用多说，如com.luxsuen
Project URL：项目站点，如：https://github.com/LuxSun/requestjson
SCM url：项目源码仓库，如：https://github.com/LuxSun/requestjson.git
</code></pre>
<p>其他内容不用填写，创建Issue后需要等待一小段时间，Sonatype的工作人员审核处理，速度还是很快的，一般一个工作日以内，当Issue的Status变为RESOLVED后，就可以进行下一步操作了，否则，就等待…</p>
<p>到这里，需要跟客服唠嗑一下~（以前这一步审核很简单，跟客服说是你的即可，现在开始要提供证明）</p>
<ul>
<li>
<p>如果是用Github，就无需注册域名，直接根据客服提示证明一下即可（新手推荐）。</p>
</li>
<li>
<p>如果是用自己的域名，就需要根据客服的提示配置下DNS。</p>
</li>
</ul>
<p>​	Ps：无论以上是哪种情况，最后只要呈现如下图所示，即代表成功！</p>
<figure data-type="image" tabindex="2"><img src="https://tianxiawuhao.github.io/post-images/1666786702549.png" alt="" loading="lazy"></figure>
<h3 id="二-配置mavenpomxml">二、配置Maven（pom.xml）</h3>
<p>接下来就是重头戏了，pom.xml是一个maven项目的重点配置，一个项目的所有配置都可以由这个文件来描述，文件中的所有配置都有默认值，也就是说所有的配置都是可选配置，但是为了把构件发布到中央仓库，我们必须配置一些关键信息，否则再发布时是不会通过了。</p>
<p>在工程的pom.xml文件中，引入Sonatype官方的一个通用配置​​oss-parent​​，这样做的好处是很多pom.xml的发布配置不需要自己配置了：</p>
<pre><code class="language-java">&lt;parent&gt;
    &lt;groupId&gt;org.sonatype.oss&lt;/groupId&gt;
    &lt;artifactId&gt;oss-parent&lt;/artifactId&gt;
    &lt;version&gt;7&lt;/version&gt;
&lt;/parent&gt;
</code></pre>
<p><strong>并增加Licenses、SCM、Developers信息</strong>：</p>
<pre><code class="language-xml">&lt;licenses&gt;
  &lt;license&gt;
    &lt;name&gt;The Apache Software License, Version 2.0&lt;/name&gt;
    &lt;url&gt;http://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt;
    &lt;distribution&gt;repo&lt;/distribution&gt;
  &lt;/license&gt;
&lt;/licenses&gt;

&lt;developers&gt;
  &lt;developer&gt;
    &lt;name&gt;Lux Sun&lt;/name&gt;
    &lt;email&gt;28554482@qq.com&lt;/email&gt;
    &lt;organization&gt;Lux Sun&lt;/organization&gt;
    &lt;url&gt;https://github.com/LuxSun&lt;/url&gt;
  &lt;/developer&gt;
&lt;/developers&gt;

&lt;scm&gt;
  &lt;url&gt;https://github.com/LuxSun/requestjson&lt;/url&gt;
  &lt;connection&gt;https://github.com/LuxSun/requestjson.git&lt;/connection&gt;
&lt;/scm&gt;
</code></pre>
<p>修改maven配置文件setting.xml，在servers中增加server配置。</p>
<pre><code class="language-xml">&lt;servers&gt;
  &lt;server&gt;
    &lt;id&gt;sonatype-nexus-snapshots&lt;/id&gt;
    &lt;username&gt;Sonatype 账号&lt;/username&gt;
    &lt;password&gt;Sonatype 密码&lt;/password&gt;
  &lt;/server&gt;

  &lt;server&gt;
    &lt;id&gt;sonatype-nexus-staging&lt;/id&gt;
    &lt;username&gt;Sonatype 账号&lt;/username&gt;
    &lt;password&gt;Sonatype 密码&lt;/password&gt;
  &lt;/server&gt;
&lt;/servers&gt;
</code></pre>
<p>根据官方指南，这里需要4个插件，</p>
<ul>
<li>maven-source-plugin 用来生成Source Jar文件</li>
<li>maven-javadoc-plugin 用来生成 javadoc 文档</li>
<li>maven-gpg-plugin 用来对工程文件进行自动签名</li>
<li>nexus-staging-maven-plugin 用来将工程发布到中央仓库</li>
</ul>
<p>另外注意生成javadoc文档时需要指定关闭doclint，不然可能因为使用了不规范的javadoc注解而导致失败，完整配置如下。</p>
<p><strong>完整版</strong></p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;

&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

  &lt;groupId&gt;com.luxsuen&lt;/groupId&gt;
  &lt;artifactId&gt;requestjson&lt;/artifactId&gt;
  &lt;version&gt;1.0.1&lt;/version&gt;
  &lt;packaging&gt;jar&lt;/packaging&gt;

  &lt;name&gt;requestjson&lt;/name&gt;
  &lt;description&gt;RequestJson&lt;/description&gt;
  &lt;url&gt;https://github.com/LuxSun/requestjson&lt;/url&gt;

  &lt;properties&gt;
    &lt;spring.version&gt;4.3.2.RELEASE&lt;/spring.version&gt;
    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;
    &lt;maven.compiler.encoding&gt;UTF-8&lt;/maven.compiler.encoding&gt;
  &lt;/properties&gt;

  &lt;licenses&gt;
    &lt;license&gt;
      &lt;name&gt;The Apache Software License, Version 2.0&lt;/name&gt;
      &lt;url&gt;http://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt;
      &lt;distribution&gt;repo&lt;/distribution&gt;
    &lt;/license&gt;
  &lt;/licenses&gt;

  &lt;developers&gt;
    &lt;developer&gt;
      &lt;name&gt;Lux Sun&lt;/name&gt;
      &lt;email&gt;28554482@qq.com&lt;/email&gt;
      &lt;organization&gt;Lux Sun&lt;/organization&gt;
      &lt;url&gt;https://github.com/LuxSun&lt;/url&gt;
    &lt;/developer&gt;
  &lt;/developers&gt;

  &lt;scm&gt;
    &lt;url&gt;https://github.com/LuxSun/requestjson&lt;/url&gt;
    &lt;connection&gt;https://github.com/LuxSun/requestjson.git&lt;/connection&gt;
  &lt;/scm&gt;

  &lt;distributionManagement&gt;
    &lt;snapshotRepository&gt;
      &lt;id&gt;ossrh&lt;/id&gt;
      &lt;name&gt;oss Snapshots Repository&lt;/name&gt;
      &lt;url&gt;https://oss.sonatype.org/content/repositories/snapshots&lt;/url&gt;
    &lt;/snapshotRepository&gt;
    &lt;repository&gt;
      &lt;id&gt;ossrh&lt;/id&gt;
      &lt;name&gt;oss Staging Repository&lt;/name&gt;
      &lt;url&gt;https://oss.sonatype.org/service/local/staging/deploy/maven2/&lt;/url&gt;
    &lt;/repository&gt;
  &lt;/distributionManagement&gt;

  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
        &lt;version&gt;3.1&lt;/version&gt;
        &lt;configuration&gt;
          &lt;source&gt;1.8&lt;/source&gt;
          &lt;target&gt;1.8&lt;/target&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;

      &lt;plugin&gt;
          &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
          &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;
          &lt;version&gt;3.0.2&lt;/version&gt;
          &lt;executions&gt;
            &lt;execution&gt;
              &lt;id&gt;default-jar&lt;/id&gt;
              &lt;phase&gt;package&lt;/phase&gt;
              &lt;goals&gt;
                &lt;goal&gt;jar&lt;/goal&gt;
              &lt;/goals&gt;
            &lt;/execution&gt;
          &lt;/executions&gt;
          &lt;configuration&gt;
            &lt;excludes&gt;
              &lt;exclude&gt;**/spring/&lt;/exclude&gt;
              &lt;exclude&gt;**/com/luxsuen/requestjson/entity/&lt;/exclude&gt;
              &lt;exclude&gt;**/com/luxsuen/requestjson/web/&lt;/exclude&gt;
              &lt;exclude&gt;**/META-INF/*.kotlin_module&lt;/exclude&gt;
            &lt;/excludes&gt;
          &lt;/configuration&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;

  &lt;/build&gt;

  &lt;profiles&gt;
    &lt;profile&gt;
      &lt;id&gt;release&lt;/id&gt;
      &lt;build&gt;
        &lt;plugins&gt;
          &lt;plugin&gt;
            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;maven-source-plugin&lt;/artifactId&gt;
            &lt;version&gt;2.2.1&lt;/version&gt;
            &lt;executions&gt;
              &lt;execution&gt;
                &lt;id&gt;attach-sources&lt;/id&gt;
                &lt;goals&gt;
                  &lt;goal&gt;jar-no-fork&lt;/goal&gt;
                &lt;/goals&gt;
              &lt;/execution&gt;
            &lt;/executions&gt;
            &lt;configuration&gt;
              &lt;excludes&gt;
                &lt;exclude&gt;**/spring/&lt;/exclude&gt;
                &lt;exclude&gt;**/com/luxsuen/requestjson/entity/&lt;/exclude&gt;
                &lt;exclude&gt;**/com/luxsuen/requestjson/web/&lt;/exclude&gt;
                &lt;exclude&gt;**/META-INF/*.kotlin_module&lt;/exclude&gt;
              &lt;/excludes&gt;
            &lt;/configuration&gt;
          &lt;/plugin&gt;

          &lt;plugin&gt;
            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;maven-javadoc-plugin&lt;/artifactId&gt;
            &lt;version&gt;2.9.1&lt;/version&gt;
            &lt;executions&gt;
              &lt;execution&gt;
                &lt;id&gt;attach-javadocs&lt;/id&gt;
                &lt;goals&gt;
                  &lt;goal&gt;jar&lt;/goal&gt;
                &lt;/goals&gt;
              &lt;/execution&gt;
            &lt;/executions&gt;
            &lt;configuration&gt;
              &lt;excludePackageNames&gt;com.luxsuen.requestjson.entity:com.luxsuen.requestjson.web&lt;/excludePackageNames&gt;
            &lt;/configuration&gt;
          &lt;/plugin&gt;
    
          &lt;plugin&gt;
            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;maven-gpg-plugin&lt;/artifactId&gt;
            &lt;version&gt;1.5&lt;/version&gt;
            &lt;executions&gt;
              &lt;execution&gt;
                &lt;id&gt;sign-artifacts&lt;/id&gt;
                &lt;phase&gt;verify&lt;/phase&gt;
                &lt;goals&gt;
                  &lt;goal&gt;sign&lt;/goal&gt;
                &lt;/goals&gt;
              &lt;/execution&gt;
            &lt;/executions&gt;
          &lt;/plugin&gt;
    
          &lt;plugin&gt;
            &lt;groupId&gt;org.sonatype.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;nexus-staging-maven-plugin&lt;/artifactId&gt;
            &lt;version&gt;1.6.7&lt;/version&gt;
            &lt;extensions&gt;true&lt;/extensions&gt;
            &lt;configuration&gt;
              &lt;serverId&gt;ossrh&lt;/serverId&gt;
              &lt;nexusUrl&gt;https://oss.sonatype.org/&lt;/nexusUrl&gt;
              &lt;autoReleaseAfterClose&gt;true&lt;/autoReleaseAfterClose&gt;
            &lt;/configuration&gt;
          &lt;/plugin&gt;
        &lt;/plugins&gt;
      &lt;/build&gt;
    &lt;/profile&gt;

  &lt;/profiles&gt;
&lt;/project&gt;
</code></pre>
<ul>
<li>
<p>注意1：以上 pom.xml 必须包括：name、description、url、licenses、developers、scm 等基本信息，此外，使用了 Maven 的 profile 功能，只有在 release 的时候，创建源码包、创建文档包、使用 GPG 进行数字签名。此外，snapshotRepository 与 repository 中的 id 一定要与 setting.xml 中 server 的 id 保持一致。</p>
</li>
<li>
<p>注意2：这里在 nexus-staging-maven-plugin 插件里开启了自动 Release。也可以关掉，然后登录构件仓库 ​ ​https://oss.sonatype.org​​ 手动去 close 然后 relseae。</p>
</li>
</ul>
<h3 id="三-配置gpg-key">三、配置gpg-key</h3>
<h4 id="1-可视化配置">1、可视化配置</h4>
<p>Windows的话先到 ​ ​https://gpg4win.org/download.html​​ 下载最新的版本，直接安装即可打开即可。</p>
<h5 id="11-新建密钥对openpgp类型">1.1、新建密钥对（OpenPGP类型）</h5>
<p>这里需要填入名字和电子邮件，然后注意可以在高级设置那里将有效期一栏的小勾取消掉，即有效期无限，如下。</p>
<figure data-type="image" tabindex="3"><img src="https://tianxiawuhao.github.io/post-images/1666786730533.png" alt="" loading="lazy"></figure>
<h5 id="12-确认信息并输入密码">1.2、确认信息并输入密码</h5>
<h5 id="13-选择将公钥上传到目录服务">1.3、选择将公钥上传到目录服务</h5>
<p>注意：如果这里不点的话后面分发后将无法在服务器找到对应公钥。</p>
<figure data-type="image" tabindex="4"><img src="https://tianxiawuhao.github.io/post-images/1666786742316.png" alt="" loading="lazy"></figure>
<h5 id="14-右键选择生成的证书在服务器上发布">1.4、右键选择生成的证书在服务器上发布</h5>
<h5 id="15-根据密钥id在服务器上查找公钥">1.5、根据密钥ID在服务器上查找公钥</h5>
<p>最终必须保证这一步成功！如下。</p>
<figure data-type="image" tabindex="5"><img src="https://tianxiawuhao.github.io/post-images/1666786765413.png" alt="" loading="lazy"></figure>
<p>Ps：注意：这里有个bug，如果生成的密钥ID的第一个字符是数字0的话，在下面使用maven-gpg插件的时候可能会被自动去掉导致密钥找不到，所以保险起见遇到这种情况就重新生成证书。</p>
<h4 id="2-命令行配置">2、命令行配置</h4>
<p>Ps：Windows系统使用“gpg”命令开头，而Mac系统使用“gpg2”命令开头。</p>
<p>如果是使用的windows，可以下载gpg4win，地址：​​https://www.gpg4win.org/download.html​​​，安装后在命令行中执行 ​​gpg --gen-key​​生成，过程中需要填写名字、邮箱等，其他步骤可以使用默认值，不过有个叫：Passphase的参数需要记住，这个相当于是是密钥的密码，下一步发布过程中进行签名操作的时候会用到。</p>
<figure data-type="image" tabindex="6"><img src="https://tianxiawuhao.github.io/post-images/1666786780362.png" alt="" loading="lazy"></figure>
<p>建议大家下载 Gpg4win-Vanilla 版本，因为它仅包括 GnuPG，这个工具才是我们所需要的。</p>
<p>安装 GPG 软件后，打开命令行窗口，依次做以下操作：</p>
<h5 id="21-查看是否安装成功">2.1、查看是否安装成功</h5>
<pre><code class="language-shell">gpg --version
</code></pre>
<p>能够显示 GPG 的版本信息，说明安装成功了。</p>
<h5 id="22-生成密钥对">2.2、生成密钥对</h5>
<pre><code class="language-shell">gpg --gen-key
</code></pre>
<p>此时需要输入姓名、邮箱等字段，其它字段可使用默认值，此外，还需要输入一个 Passphase，相当于一个密钥库的密码，一定不要忘了，也不要告诉别人，最好记下来，因为后面会用到。</p>
<h5 id="23-查看公钥">2.3、查看公钥</h5>
<pre><code class="language-shell">gpg --list-keys
</code></pre>
<p>输出如下信息（新版本可能格式会有点区别，不用担心，是正常的）：</p>
<pre><code>C:/Users/huangyong/AppData/Roaming/gnupg/pubring.gpg
----------------------------------------------------

pub   2048R/82DC852E 2014-04-24
uid                  hy_think &lt;hy_think@163.com&gt;
sub   2048R/3ACA39AF 2014-04-24
</code></pre>
<p>可见这里的公钥的 ID 是：82DC852E，很明显是一个 16 进制的数字，马上就会用到。</p>
<h5 id="24-将公钥发布到-pgp-密钥服务器后面还需要操作此步骤">2.4、将公钥发布到 PGP 密钥服务器（后面还需要操作此步骤）</h5>
<pre><code class="language-shell">gpg --keyserver hkp://pool.sks-keyservers.net --send-keys 82DC852E
</code></pre>
<p>此后，可使用本地的私钥来对上传构件进行数字签名，而下载该构件的用户可通过上传的公钥来验证签名，也就是说，大家可以验证这个构件是否由本人上传的，因为有可能该构件被坏人给篡改了。</p>
<h5 id="25-查询公钥是否发布成功">2.5、查询公钥是否发布成功</h5>
<pre><code class="language-shell">gpg --keyserver hkp://pool.sks-keyservers.net --recv-keys 82DC852E
</code></pre>
<p>实际上就是从 key server 上通过公钥 ID 来接收公钥，此外，也可以到 sks-keyservers.net 上通过公钥 ID 去查询。</p>
<h3 id="四-上传构件到-oss-中">四、上传构件到 OSS 中</h3>
<p>这步就简单了，就是一套命令：</p>
<pre><code class="language-shell">mvn clean deploy -P sonatype-oss-release -Darguments=&quot;gpg.passphrase=密钥密码&quot;
</code></pre>
<p>如果使用eclipse的mvn插件发布的话，配置如下（IDEA类似）：</p>
<figure data-type="image" tabindex="7"><img src="https://tianxiawuhao.github.io/post-images/1666786795135.png" alt="" loading="lazy"></figure>
<p>如果发布成功，就可以到构件仓库中查看了。</p>
<p>或者</p>
<p>先通过 cmd 进入到项目的这个目录下。</p>
<figure data-type="image" tabindex="8"><img src="https://tianxiawuhao.github.io/post-images/1666786809041.png" alt="" loading="lazy"></figure>
<p>再执行下面命令。</p>
<pre><code class="language-shell">mvn clean deploy -P release
</code></pre>
<p>当执行以上 Maven 命令时，会自动弹出一个对话框，需要输入上面提到的 Passphase，它就是通过 GPG 密钥对的密码，只有自己才知道。随后会看到大量的 upload 信息，而且速度比较慢，经常会 timeout，需要反复尝试。</p>
<p>注意：此时上传的构件并未正式发布到中央仓库中，只是部署到 OSS 中了，下面才是真正的发布。</p>
<h3 id="五-在-oss-中发布构件">五、在 OSS 中发布构件</h3>
<p>进入​​https://oss.sonatype.org/#stagingRepositories​​​查看发布好的构件，点击左侧的​​Staging Repositories​​​，一般最后一个就是刚刚发布的jar了，此时的构件状态为​​open​​。</p>
<p>打开命令行窗口，查看gpg key并上传到第三方的key验证库：</p>
<pre><code class="language-shell">E:\98_code\workSpace\marathon-client&gt;gpg --list-keys

C:/Users/VF/AppData/Roaming/gnupg/pubring.gpg
---------------------------------------------

pub   2048R/824B4D7A 2016-01-06
uid       [ultimate] cloudnil &lt;cloudnil@126.com&gt;
sub   2048R/7A10AD69 2016-01-06


E:\98_code\workSpace\marathon-client&gt;gpg --keyserver hkp://keyserver.ubuntu.com:11371 --send-keys 824B4D7A
gpg: sending key 824B4D7A to hkp server keyserver.ubuntu.com

E:\98_code\workSpace\marathon-client&gt;
</code></pre>
<p>回到 ​ ​https://oss.sonatype.org/#stagingRepositories​​，选中刚才发布的构件，并点击上方的close–&gt;Confirm，在下边的Activity选项卡中查看状态，当状态变成closed后，执行Release–&gt;Confirm，并在下边的Activity选项卡中查看状态，成功后构件自动删除。</p>
<p>需要在曾经创建的 Issue 下面回复一条“构件已成功发布”的评论，这是为了通知 Sonatype 的工作人员为需要发布的构件做审批，发布后会关闭该 Issue。</p>
<p>一小段时间（约1-2个小时）后即可同步到​ ​https://search.maven.org​​​中央仓库（Maven中央仓库可能需要24-48小时：​ ​https://mvnrepository.com​​）。</p>
<figure data-type="image" tabindex="9"><img src="https://tianxiawuhao.github.io/post-images/1666786827207.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="10"><img src="https://tianxiawuhao.github.io/post-images/1666786836649.png" alt="" loading="lazy"></figure>
<p>Ps：注意这里有个大坑，之前很多教程都会把这个步骤提前到最开始（我不是说生成密钥这个环节，这个密钥生成环节的确是一开始就可以弄了的），但下面这句解析需要到这一步再开始搞，之前一直在https://oss.sonatype.org/#stagingRepositories这里审核一直失败，大坑呀~</p>
<p>最后，想说一句：第一次都是很痛的，以后就舒服了。没错，只有第一次发布才如此痛苦，以后 deploy 的构件会自动部发布到中央仓库，无需再这样折腾了。（附加：成功效果图）</p>
<figure data-type="image" tabindex="11"><img src="https://tianxiawuhao.github.io/post-images/1666786845695.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="12"><img src="https://tianxiawuhao.github.io/post-images/1666786857593.png" alt="" loading="lazy"></figure>
<p>附：<br>
在编码过程中，有些通用的代码模块，有时候我们不想通过复制拷贝来粗暴地复用，因为这样不仅体现不了变化，也不利于统一管理。这里我们使用maven deploy的方式，将通用的模块打成jar包，发布到nexus，让其他的项目来引用，以更简洁高效的方式来实现复用和管理。</p>
<ul>
<li>
<p>第一：maven的settings.xml文件中设置<server>标签</p>
<pre><code class="language-xml">&lt;server&gt;
  &lt;id&gt;my-deploy-release&lt;/id&gt;
  &lt;username&gt;admin&lt;/username&gt;
  &lt;password&gt;admin123&lt;/password&gt;
&lt;/server&gt;

&lt;server&gt;
  &lt;id&gt;my-deploy-snapshot&lt;/id&gt;
  &lt;username&gt;admin&lt;/username&gt;
  &lt;password&gt;admin123&lt;/password&gt;
&lt;/server&gt;
</code></pre>
<p>此处设置的用户名和密码都是nexus的登陆配置。</p>
</li>
<li>
<p>第二：在项目的pom.xml文件中设置</p>
<pre><code class="language-xml">&lt;distributionManagement&gt;
    &lt;repository&gt;
        &lt;id&gt;my-deploy-release&lt;/id&gt;
        &lt;url&gt;http://192.168.1.123:8081/nexus/content/repositories/releases/&lt;/url&gt;
    &lt;/repository&gt;

    &lt;snapshotRepository&gt;
        &lt;id&gt;my-deploy-snapshot&lt;/id&gt;
        &lt;url&gt;http://192.168.1.123:8081/nexus/content/repositories/snapshots/&lt;/url&gt;
    &lt;/snapshotRepository&gt;

&lt;/distributionManagement&gt;
</code></pre>
<p>在此，url都是nexus相应仓库的链接地址，这一步做完之后，已经完成了发布所需要的基本配置。【试试命令：mvn deploy】</p>
<p>注意：<server>中的<id>要和<repository>、<snapshotRepository>的<id>一致，maven在发布时，会根据此id来查找相应的用户名密码进行登录验证并上传文件。</p>
</li>
<li>
<p>第三：发布的灵活性配置</p>
<p>maven会判断版本后面是否带了-SNAPSHOT，如果带了就发布到snapshots仓库，否则发布到release仓库。这里我们可以在pom.xml文件中，设置。</p>
<pre><code class="language-xml">&lt;groupId&gt;com.test&lt;/groupId&gt;
&lt;artifactId&gt;my-test&lt;/artifactId&gt;
&lt;packaging&gt;jar&lt;/packaging&gt;
&lt;version&gt;${project.release.version}&lt;/version&gt;

&lt;properties&gt;
    &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;project.release.version&gt;1.0-SNAPSHOT&lt;/project.release.version&gt;
&lt;/properties&gt;

&lt;profiles&gt;
    &lt;profile&gt;
        &lt;id&gt;product&lt;/id&gt;
        &lt;properties&gt;
            &lt;project.release.version&gt;1.0&lt;/project.release.version&gt;
        &lt;/properties&gt;
    &lt;/profile&gt;
&lt;/profiles&gt;
</code></pre>
<p>说明：通过占位符${project.release.version}来控制需要发布的版本，用命令mvn deploy -P product，发布my-test的1.0版本到releases库。如果使用命令mvn deploy，则默认使用 1.0-SNAPSHOT版本号，将发布my-test的1.0-SNAPSHOT版本到snapshots库。</p>
</li>
<li>
<p>第四：发布时遇到的一些问题</p>
<p>部署到snapshot仓库时，jar包会带上时间戳，这没关系，maven会自动取相应版本最新的jar包；<br>
Failed to execute goal org.apache.maven.plugins:maven-deploy-plugin:2.8.2:deploy (default-deploy) on project my-test: Failed to deploy artifacts: Could not transfer artifact...from/to release...部署到release仓库时，相同版本的jar包不能提交。<br>
原因：因为release的部署策略是【disable redeploy】，不允许覆盖更新组件。<br>
解决办法：修改一下版本号，再提交即可。之前其实还可以通过人工客服聊天帮忙删除不想要的Jar包，但是现在不行了，只能通过上传新版本，所以有些童鞋想做测试的需要注意这一点。<br>
打包指定的文件/文件夹在代码中也有体现（含：doc、sources、class）。<br>
Maven deploy 时，为什么没有生成对应的 javadoc 和 sources （前提已经有插件部署好）？</p>
</li>
</ul>

          <div class="toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li>
<ul>
<li><a href="#%E5%89%8D%E8%A8%80">前言</a></li>
<li><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">注意事项</a></li>
<li><a href="#%E4%B8%80-%E5%88%9B%E5%BB%BA%E5%B7%A5%E5%8D%95">一、创建工单</a></li>
<li><a href="#%E4%BA%8C-%E9%85%8D%E7%BD%AEmavenpomxml">二、配置Maven（pom.xml）</a></li>
<li><a href="#%E4%B8%89-%E9%85%8D%E7%BD%AEgpg-key">三、配置gpg-key</a>
<ul>
<li><a href="#1-%E5%8F%AF%E8%A7%86%E5%8C%96%E9%85%8D%E7%BD%AE">1、可视化配置</a>
<ul>
<li><a href="#11-%E6%96%B0%E5%BB%BA%E5%AF%86%E9%92%A5%E5%AF%B9openpgp%E7%B1%BB%E5%9E%8B">1.1、新建密钥对（OpenPGP类型）</a></li>
<li><a href="#12-%E7%A1%AE%E8%AE%A4%E4%BF%A1%E6%81%AF%E5%B9%B6%E8%BE%93%E5%85%A5%E5%AF%86%E7%A0%81">1.2、确认信息并输入密码</a></li>
<li><a href="#13-%E9%80%89%E6%8B%A9%E5%B0%86%E5%85%AC%E9%92%A5%E4%B8%8A%E4%BC%A0%E5%88%B0%E7%9B%AE%E5%BD%95%E6%9C%8D%E5%8A%A1">1.3、选择将公钥上传到目录服务</a></li>
<li><a href="#14-%E5%8F%B3%E9%94%AE%E9%80%89%E6%8B%A9%E7%94%9F%E6%88%90%E7%9A%84%E8%AF%81%E4%B9%A6%E5%9C%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E5%8F%91%E5%B8%83">1.4、右键选择生成的证书在服务器上发布</a></li>
<li><a href="#15-%E6%A0%B9%E6%8D%AE%E5%AF%86%E9%92%A5id%E5%9C%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E6%9F%A5%E6%89%BE%E5%85%AC%E9%92%A5">1.5、根据密钥ID在服务器上查找公钥</a></li>
</ul>
</li>
<li><a href="#2-%E5%91%BD%E4%BB%A4%E8%A1%8C%E9%85%8D%E7%BD%AE">2、命令行配置</a>
<ul>
<li><a href="#21-%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F">2.1、查看是否安装成功</a></li>
<li><a href="#22-%E7%94%9F%E6%88%90%E5%AF%86%E9%92%A5%E5%AF%B9">2.2、生成密钥对</a></li>
<li><a href="#23-%E6%9F%A5%E7%9C%8B%E5%85%AC%E9%92%A5">2.3、查看公钥</a></li>
<li><a href="#24-%E5%B0%86%E5%85%AC%E9%92%A5%E5%8F%91%E5%B8%83%E5%88%B0-pgp-%E5%AF%86%E9%92%A5%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8E%E9%9D%A2%E8%BF%98%E9%9C%80%E8%A6%81%E6%93%8D%E4%BD%9C%E6%AD%A4%E6%AD%A5%E9%AA%A4">2.4、将公钥发布到 PGP 密钥服务器（后面还需要操作此步骤）</a></li>
<li><a href="#25-%E6%9F%A5%E8%AF%A2%E5%85%AC%E9%92%A5%E6%98%AF%E5%90%A6%E5%8F%91%E5%B8%83%E6%88%90%E5%8A%9F">2.5、查询公钥是否发布成功</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E4%B8%8A%E4%BC%A0%E6%9E%84%E4%BB%B6%E5%88%B0-oss-%E4%B8%AD">四、上传构件到 OSS 中</a></li>
<li><a href="#%E4%BA%94-%E5%9C%A8-oss-%E4%B8%AD%E5%8F%91%E5%B8%83%E6%9E%84%E4%BB%B6">五、在 OSS 中发布构件</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
          <hr />
          
            <p class="prev-post">上一篇：
              <a href="https://tianxiawuhao.github.io/DCnCuY10S/">
                <span class="post-title">
                  切面链实现&rarr;
                </span>
              </a>
            </p>
          
          
          <p class="next-post">下一篇：
            <a href="https://tianxiawuhao.github.io/Ija68kq2u/">
              <span class="post-title">
                Kubernetes的存储&rarr;
              </span>
            </a>
          </p>
          
          <div class="comment" style="text-align: center;">
            

            
            
          </div>
        </div>
      </div>
    </div>
  </article>
  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <ul class="list-inline text-center">
            
            
              
            
              
            
              
            
              
            
              
            
              
            
              
              <!-- <li class="list-inline-item">
              <a href="https://tianxiawuhao.github.io/atom.xml" target="_blank">
                <span class="fa-stack fa-lg">
                  <i class="fas fa-circle fa-stack-2x"></i>
                  <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
                </span>
              </a>
              </li> -->
          </ul>
          <p class="copyright text-muted">Copyright &copy;<span>tianxia</span><br><a href="https://github.com/getgridea/gridea" class="Themeinfo">Powered by Gridea</a></p>
        </div>
      </div>
    </div>
   </footer>
  <!-- Bootstrap core JavaScript -->
  <script src="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
  <!-- <script src="https://tianxiawuhao.github.io/media/scripts/bootstrap.bundle.min.js"></script> -->
  <!-- Bootstrap core JavaScript -->
  <script src="https://cdn.jsdelivr.net/gh/Alanrk/clean-cdn@1.0/scripts/clean-blog.min.js"></script>
  <!-- <script src="https://tianxiawuhao.github.io/media/scripts/clean-blog.min.js"></script> -->
  <script src="//instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
  <style type="text/css">a.back_to_top{text-decoration:none;position:fixed;bottom:40px;right:30px;background:#f0f0f0;height:40px;width:40px;border-radius:50%;line-height:36px;font-size:18px;text-align:center;transition-duration:.5s;transition-propety:background-color;display:none}a.back_to_top span{color:#888}a.back_to_top:hover{cursor:pointer;background:#dfdfdf}a.back_to_top:hover span{color:#555}@media print,screen and(max-width:580px){.back_to_top{display:none!important}}</style>
<a id="back_to_top" href="#" class="back_to_top">
  <span>▲</span></a>
<script>$(document).ready((function(_this) {
    return function() {
      var bt;
      bt = $('#back_to_top');
      if ($(document).width() > 480) {
        $(window).scroll(function() {
          var st;
          st = $(window).scrollTop();
          if (st > 30) {
            return bt.css('display', 'block')
          } else {
            return bt.css('display', 'none')
          }
        });
        return bt.click(function() {
          $('body,html').animate({
            scrollTop: 0
          },
          800);
          return false
        })
      }
    }
  })(this));</script>
  
  <script src="https://tianxiawuhao.github.io/media/scripts/tocScript.js"></script>
</body>

</html>