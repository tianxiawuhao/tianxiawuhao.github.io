<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<meta name="referrer" content="never">
<meta name="keywords" content="">
<meta name="description" content="欢迎访问[tianxia]的个人博客">
<meta name="author" content="kveln">
<title>序列化工具Protobuf | tianxia</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css">
<link href="https://cdn.bootcss.com/font-awesome/5.11.2/css/all.min.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
<link
  href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'
  rel='stylesheet' type='text/css'>
<link rel="alternate" type="application/rss+xml" title="序列化工具Protobuf | tianxia » Feed"
  href="https://tianxiawuhao.github.io/atom.xml">
<link rel="stylesheet"
  href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.10/build/styles/androidstudio.min.css">
<link href="https://tianxiawuhao.github.io/styles/main.css" rel="stylesheet">
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/850552586/ericamcdn@0.1/css/live2d.css">

<script>hljs.initHighlightingOnLoad();</script>

  <meta property="og:description" content="序列化工具Protobuf" />
  <meta property="og:url" content="https://tianxiawuhao.github.io/A4ZOEAhc9/" />
  <meta property="og:locale" content="zh-CN" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="tianxia" />
  <!-- <script src="../assets/styles/scripts/tocScript.js"></script> -->
</head>

<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="https://tianxiawuhao.github.io">tianxia</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
      data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
      aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        
        <li class="nav-item">
          
          <a class="nav-link" href="https://tianxiawuhao.github.io">首页</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/archives">归档</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/tags">标签</a>
          
        </li>
        
        <li class="nav-item">
          <div class="gridea-search-container">
            <form id="gridea-search-form" style="position: relative" data-update="1742729663519"
              action="/search/index.html">
              <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
              <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>
  <!-- Page Header -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="https://tianxiawuhao.github.io">tianxia</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
      data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
      aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        
        <li class="nav-item">
          
          <a class="nav-link" href="https://tianxiawuhao.github.io">首页</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/archives">归档</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/tags">标签</a>
          
        </li>
        
        <li class="nav-item">
          <div class="gridea-search-container">
            <form id="gridea-search-form" style="position: relative" data-update="1742729663519"
              action="/search/index.html">
              <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
              <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>
<header class="masthead" style="background-image: url('https://tianxiawuhao.github.io/media/images/home-bg.jpg')">
  <div class="overlay"></div>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        
          <!-- 没Title为其他页面Header -->
          
            <!-- 没Title并且有headerType为Post：文章Header -->
            <div class="post-heading">
              <span class="tags">
                
                <a href="https://tianxiawuhao.github.io/6l4aXFMiY/" class="tag">java</a>
                
                <a href="https://tianxiawuhao.github.io/B1L5Wk6DSX/" class="tag">protobuf</a>
                
              </span>
              <h1>序列化工具Protobuf</h1>
              <span class="meta">
                Posted on
                2022-10-22，9 min read
              </span>
            </div>
          
        
      </div>
    </div>
  </div>
</header>
  <!-- Post Content -->
  <article id="post-content-article">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto post-content-container">
          
          <img class="post-feature-header-image" src="https://tianxiawuhao.github.io/post-images/A4ZOEAhc9.png" alt="封面图">
          </img>
          
          <h2 id="netty的编码和解码">Netty的编码和解码</h2>
<ul>
<li>编写网络应用程序时，因为数据在网络中传输的都是二进制字节码数据，在发送数据时就需要编码，接收数据时就需要解码</li>
<li>codec(编解码器) 的组成部分有两个：decoder(解码器)和 encoder(编码器)。encoder 负责把业务数据转换成字节码数据，decoder 负责把字节码数据转换成业务数据。</li>
</ul>
<figure data-type="image" tabindex="1"><img src="https://tianxiawuhao.github.io/post-images/1666416577177.webp" alt="" loading="lazy"></figure>
<h3 id="netty提供的编码器和解码器">Netty提供的编码器和解码器</h3>
<ul>
<li>Netty 提供的编码器</li>
<li>StringEncoder，对字符串数据进行编码</li>
<li>ObjectEncoder，对 Java 对象进行编码</li>
<li>Netty 提供的解码器
<ul>
<li>StringDecoder, 对字符串数据进行解码</li>
<li>ObjectDecoder，对 Java 对象进行解码</li>
</ul>
</li>
</ul>
<h3 id="netty本身的编解码的机制和问题分析"><strong>Netty本身的编解码的机制和问题分析</strong></h3>
<ul>
<li>Netty 本身自带的 ObjectDecoder 和 ObjectEncoder 可以用来实现 POJO 对象或各种业务对象的编码和解码，底层使用的仍是 Java 序列化技术 , 而Java 序列化技术本身效率就不高，存在如下问题</li>
<li>无法跨语言</li>
<li>序列化后的体积太大，是二进制编码的 5 倍多。</li>
<li>序列化性能太低</li>
</ul>
<h2 id="protobuf简介">Protobuf简介</h2>
<p><code>Protobuf</code>是用来将对象序列化的，相类似的技术还有<code>Json</code>序列化等等。它是一种高效的结构化数据存储格式，可以用于结构化数据串行化（序列化）。</p>
<ul>
<li>
<p>Protobuf 是以 message 的方式来管理数据的</p>
</li>
<li>
<p>支持跨平台、跨语言，即[客户端和服务器端可以是不同的语言编写的] （支持目前绝大多数语言，例如 C++、C#、Java、python 等</p>
</li>
<li>
<p>高性能，高可靠性</p>
</li>
<li>
<p>使用 protobuf 编译器能自动生成代码，Protobuf 是将类的定义使用.proto 文件进行描述。说明，在idea 中编写 .proto 文件时，会自动提示是否下载 .ptotot 编写插件. 可以让语法高亮。</p>
</li>
<li>
<p>然后通过 protoc.exe 编译器根据.proto 自动生成.java 文件</p>
</li>
</ul>
<figure data-type="image" tabindex="2"><img src="https://tianxiawuhao.github.io/post-images/1666416591562.webp" alt="" loading="lazy"></figure>
<h3 id="protobufexe下载">Protobuf.exe下载</h3>
<p><a href="https://github.com/protocolbuffers/protobuf/releases">https://github.com/protocolbuffers/protobuf/releases</a></p>
<h3 id="protobuf中的变量类型和其他语言对照表">protobuf中的变量类型和其他语言对照表</h3>
<figure data-type="image" tabindex="3"><img src="https://tianxiawuhao.github.io/post-images/1666416605562.webp" alt="" loading="lazy"></figure>
<h3 id="protobuf的使用">Protobuf的使用</h3>
<h4 id="定义proto文件">定义proto文件</h4>
<pre><code class="language-go">syntax = &quot;proto3&quot;; //版本
option optimize_for = SPEED; //加快解析
option java_outer_classname = &quot;MyDataInfo&quot;; //生成的外部类名，同时也是文件名

message MyMessage {
    //定义一个枚举类型
    enum DateType {
        StudentType = 0; //在proto3中，要求enum的编号从0开始
        WorkerType = 1;
    }

    //相当于message的属性，用data_type来标识传的是哪一个枚举类型，1表示属性序号1
    DateType data_type = 1;

    //标识每次枚举类型最多只能出现其中的一个类型，节省空间
    oneof dataBody {
        Student stuent = 2;
        Worker worker = 3;
    }
}

message Student { //会在StudentPojo 外部类生成一个内部类Student，他是真正发送的pojo对象
    int32 id = 1; //Student类中有一个属性名字为ID，类型为int32（protobuf类型），1表示序号，不是值
    string name = 2;
}
message Worker {
    string name = 1;
    int32 age = 2;
}
</code></pre>
<h4 id="生成java文件">生成java文件</h4>
<pre><code class="language-shell">protoc.exe --java_out=. xxx.proto
</code></pre>
<figure data-type="image" tabindex="4"><img src="https://tianxiawuhao.github.io/post-images/1666416614388.webp" alt="" loading="lazy"></figure>
<h4 id="pom">pom</h4>
<pre><code class="language-xml">&lt;!--序列化工具protobuf--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.google.protobuf&lt;/groupId&gt;
    &lt;artifactId&gt;protobuf-java&lt;/artifactId&gt;
    &lt;version&gt;3.15.3&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>注意protoc.exe下载的版本是3.15.3，这里protobuf的pom依赖也得是对应的版本，否则protoc.exe生成的java文件放入项目中报错。</p>
<h4 id="客户端">客户端</h4>
<pre><code class="language-java">
public class Client {

    //属性
    private final String host;
    private final int port;

    public Client(String host, int port) {
        this.port = port;
        this.host = host;
    }

    public void run() throws InterruptedException {
        NioEventLoopGroup eventExecutors = new NioEventLoopGroup();
        try {
            Bootstrap bootstrap = new Bootstrap()
                    .group(eventExecutors)
                    .channel(NioSocketChannel.class)
                    .handler(new ChannelInitializer&lt;SocketChannel&gt;() {
                        @Override
                        protected void initChannel(SocketChannel ch) throws Exception {
                            ChannelPipeline pipeline = ch.pipeline();
                            //加入Handler
                            pipeline.addLast(&quot;encoder&quot;,new ProtobufEncoder());
                            pipeline.addLast(new GroupChatClientHandler());
                        }
                    });
            ChannelFuture channelFuture = bootstrap.connect(host, port).sync();
            //得到channel
            Channel channel = channelFuture.channel();
            System.out.println(&quot;--------&quot; + channel.localAddress() + &quot;---------&quot;);
            //客户端需要输入信息，创建一个扫描器
            Scanner scanner = new Scanner(System.in);
            MyDataInfo.MyMessage message = null;
            while (scanner.hasNextLine()){
                String msg = scanner.nextLine();
                if (&quot;1&quot;.equals(msg)){
                    message = MyDataInfo.MyMessage.
                            newBuilder().
                            setDataType(MyDataInfo.MyMessage.DateType.StudentType)
                            .setStuent(MyDataInfo.Student
                                    .newBuilder()
                                    .setId(5)
                                    .setName(&quot;王五&quot;)
                                    .build())
                            .build();
                }else {
                    message = MyDataInfo.MyMessage.
                            newBuilder().
                            setDataType(MyDataInfo.MyMessage.DateType.WorkerType).
                            setWorker(MyDataInfo.Worker.
                                    newBuilder().
                                    setName(&quot;李四&quot;).
                                    setAge(11).
                                    build()).build();
                }
                channel.writeAndFlush(message);
            }
        } finally {
            eventExecutors.shutdownGracefully();
        }
    }

    public static void main(String[] args) throws InterruptedException {
        new Client(&quot;127.0.0.1&quot;, 7000).run();
    }
}
</code></pre>
<h4 id="服务端">服务端</h4>
<pre><code class="language-java">package com.pl.netty.protobuf;

public class Server {
    private int port;

    public Server(int port) {
        this.port = port;
    }

    public void run(){
        //bossGroup 用于接收连接
        NioEventLoopGroup bossGroup = new NioEventLoopGroup(1);
        //workerGroup 用于具体的处理
        NioEventLoopGroup workerGroup = new NioEventLoopGroup();
        try {
            // Bootstrap 类是客户端程序的启动引导类，ServerBootstrap 是服务端启动引导类
            ServerBootstrap serverBootstrap = new ServerBootstrap();
            serverBootstrap.group(bossGroup,workerGroup)
                    //Netty 网络通信的组件，能够用于执行网络 I/O 操作。 选择哪种channel 异步的服务器端 TCP Socket 连接
                    .channel(NioServerSocketChannel.class)
                    //ChannelOption.SO_BACKLOG 对应 TCP/IP 协议 listen 函数中的 backlog 参数，用来初始化服务器可连接队列大小。
                    //服务端处理客户端连接请求是顺序处理的，所以同一时间只能处理一个客户端连接。多个客户端来的时候，服务端将不能处理的客户端连接请求放在队列中等待处理，backlog 参数指定了队列的大小。
                    //Socket参数，服务端接受连接的队列长度，如果队列已满，客户端连接将被拒绝。默认值，Windows为200，其他为128。
                    .option(ChannelOption.SO_BACKLOG,128)
                    //Netty中的option主要是设置的ServerChannel的一些选项，而childOption主要是设置的ServerChannel的子Channel的选项。
                    //SO_KEEPALIVE 连接保活，默认值为False。启用该功能时，TCP会主动探测空闲连接的有效性。可以将此功能视为TCP的心跳机制，需要注意的是：默认的心跳间隔是7200s即2小时。Netty默认关闭该功能。
                    .childOption(ChannelOption.SO_KEEPALIVE, true)
                    //定义worker
                    .childHandler(new ChannelInitializer&lt;SocketChannel&gt;() {
                        @Override
                        protected void initChannel(SocketChannel socketChannel) throws Exception {
                            ChannelPipeline pipeline = socketChannel.pipeline();
                            pipeline.addLast(&quot;decoder&quot;,new ProtobufDecoder(MyDataInfo.MyMessage.getDefaultInstance()));
                            pipeline.addLast(new GroupChatServerHandler());
                        }
                    });
            System.out.println(&quot;netty 服务端启动&quot;);
            //Netty 中所有的 IO 操作都是异步的，不能立刻得知消息是否被正确处理。但是可以过一会等它执行完成或者直接注册一个监听，具体的实现就是通过 Future 和 ChannelFutures，他们可以注册一个监听，当操作执行成功或失败时监听会自动触发注册的监听事件
            ChannelFuture channelFuture = serverBootstrap.bind(port).sync();
            //监听关闭事件
            channelFuture.channel().closeFuture().sync();
        }catch (InterruptedException e) {
            e.printStackTrace();
        }finally {
            bossGroup.shutdownGracefully();
            workerGroup.shutdownGracefully();
        }
    }

    public static void main(String[] args) {
        Server server = new Server(7000);
        server.run();
    }
}
</code></pre>
<h4 id="groupchatserverhandler">GroupChatServerHandler</h4>
<pre><code class="language-java">package com.pl.netty.protobuf;
/**
 * @Description: TODO
 * @ClassName GroupchatServerHandler  继承 SimpleChannelInboundHandler 入栈，指定信息泛型为MyDataInfo.MyMessage
 * @Version V1.0.0
 */
public class GroupChatServerHandler extends SimpleChannelInboundHandler&lt;MyDataInfo.MyMessage&gt; {
    //定义一个Channel组，管理所有的channel
    //GlobalEventExecutor.INSTANCE 是全局事件执行器，是一个单例
    private static ChannelGroup channelGroup = new DefaultChannelGroup(GlobalEventExecutor.INSTANCE);
    SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);

    //此方法表示连接建立，一旦建立连接，就第一个被执行
    @Override
    public void handlerAdded(ChannelHandlerContext ctx) throws Exception {
        Channel channel = ctx.channel();
        //该方法会将 channelGroup 中所有 channel 遍历，并发送消息，而不需要我们自己去遍历
        channelGroup.writeAndFlush(&quot;[客户端]&quot; + channel.remoteAddress() + sdf.format(new Date()) + &quot;加入聊天\n&quot;);
        //将当前的Channel加入到 ChannelGroup
        channelGroup.add(channel);
    }

    //表示 channel 处于活动状态，提示 xxx 上线
    @Override
    public void channelActive(ChannelHandlerContext ctx) throws Exception {
        System.out.println(ctx.channel().remoteAddress() + &quot; &quot; + sdf.format(new Date()) + &quot;上线了~&quot;);
    }

    //表示 channel 处于不活动状态，提示 xxx 离线
    @Override
    public void channelInactive(ChannelHandlerContext ctx) throws Exception {
        System.out.println(ctx.channel().remoteAddress() + &quot; &quot; + sdf.format(new Date()) + &quot;离线了~&quot;);
    }
    @Override
    protected void channelRead0(ChannelHandlerContext channelHandlerContext, MyDataInfo.MyMessage msg) throws Exception {
        MyDataInfo.MyMessage.DateType dataType = msg.getDataType();
        if (dataType == MyDataInfo.MyMessage.DateType.StudentType){
            MyDataInfo.Student student = msg.getStuent();
            System.out.println(&quot;学生Id = &quot; + student.getId() + student.getName());
        }else if (dataType == MyDataInfo.MyMessage.DateType.WorkerType){
            MyDataInfo.Worker worker = msg.getWorker();
            System.out.println(&quot;工人：name = &quot; + worker.getName() + worker.getAge());
        }else {
            System.out.println(&quot;输入的类型不正确&quot;);
        }
    }

}
</code></pre>

          <div class="toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#netty%E7%9A%84%E7%BC%96%E7%A0%81%E5%92%8C%E8%A7%A3%E7%A0%81">Netty的编码和解码</a>
<ul>
<li><a href="#netty%E6%8F%90%E4%BE%9B%E7%9A%84%E7%BC%96%E7%A0%81%E5%99%A8%E5%92%8C%E8%A7%A3%E7%A0%81%E5%99%A8">Netty提供的编码器和解码器</a></li>
<li><a href="#netty%E6%9C%AC%E8%BA%AB%E7%9A%84%E7%BC%96%E8%A7%A3%E7%A0%81%E7%9A%84%E6%9C%BA%E5%88%B6%E5%92%8C%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90"><strong>Netty本身的编解码的机制和问题分析</strong></a></li>
</ul>
</li>
<li><a href="#protobuf%E7%AE%80%E4%BB%8B">Protobuf简介</a>
<ul>
<li><a href="#protobufexe%E4%B8%8B%E8%BD%BD">Protobuf.exe下载</a></li>
<li><a href="#protobuf%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%85%B6%E4%BB%96%E8%AF%AD%E8%A8%80%E5%AF%B9%E7%85%A7%E8%A1%A8">protobuf中的变量类型和其他语言对照表</a></li>
<li><a href="#protobuf%E7%9A%84%E4%BD%BF%E7%94%A8">Protobuf的使用</a>
<ul>
<li><a href="#%E5%AE%9A%E4%B9%89proto%E6%96%87%E4%BB%B6">定义proto文件</a></li>
<li><a href="#%E7%94%9F%E6%88%90java%E6%96%87%E4%BB%B6">生成java文件</a></li>
<li><a href="#pom">pom</a></li>
<li><a href="#%E5%AE%A2%E6%88%B7%E7%AB%AF">客户端</a></li>
<li><a href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF">服务端</a></li>
<li><a href="#groupchatserverhandler">GroupChatServerHandler</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
          <hr />
          
            <p class="prev-post">上一篇：
              <a href="https://tianxiawuhao.github.io/Ija68kq2u/">
                <span class="post-title">
                  Kubernetes的存储&rarr;
                </span>
              </a>
            </p>
          
          
          <p class="next-post">下一篇：
            <a href="https://tianxiawuhao.github.io/SznSzjoX7/">
              <span class="post-title">
                minio新版搭建和数据迁移&rarr;
              </span>
            </a>
          </p>
          
          <div class="comment" style="text-align: center;">
            

            
            
          </div>
        </div>
      </div>
    </div>
  </article>
  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <ul class="list-inline text-center">
            
            
              
            
              
            
              
            
              
            
              
            
              
            
              
              <!-- <li class="list-inline-item">
              <a href="https://tianxiawuhao.github.io/atom.xml" target="_blank">
                <span class="fa-stack fa-lg">
                  <i class="fas fa-circle fa-stack-2x"></i>
                  <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
                </span>
              </a>
              </li> -->
          </ul>
          <p class="copyright text-muted">Copyright &copy;<span>tianxia</span><br><a href="https://github.com/getgridea/gridea" class="Themeinfo">Powered by Gridea</a></p>
        </div>
      </div>
    </div>
   </footer>
  <!-- Bootstrap core JavaScript -->
  <script src="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
  <!-- <script src="https://tianxiawuhao.github.io/media/scripts/bootstrap.bundle.min.js"></script> -->
  <!-- Bootstrap core JavaScript -->
  <script src="https://cdn.jsdelivr.net/gh/Alanrk/clean-cdn@1.0/scripts/clean-blog.min.js"></script>
  <!-- <script src="https://tianxiawuhao.github.io/media/scripts/clean-blog.min.js"></script> -->
  <script src="//instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
  <style type="text/css">a.back_to_top{text-decoration:none;position:fixed;bottom:40px;right:30px;background:#f0f0f0;height:40px;width:40px;border-radius:50%;line-height:36px;font-size:18px;text-align:center;transition-duration:.5s;transition-propety:background-color;display:none}a.back_to_top span{color:#888}a.back_to_top:hover{cursor:pointer;background:#dfdfdf}a.back_to_top:hover span{color:#555}@media print,screen and(max-width:580px){.back_to_top{display:none!important}}</style>
<a id="back_to_top" href="#" class="back_to_top">
  <span>▲</span></a>
<script>$(document).ready((function(_this) {
    return function() {
      var bt;
      bt = $('#back_to_top');
      if ($(document).width() > 480) {
        $(window).scroll(function() {
          var st;
          st = $(window).scrollTop();
          if (st > 30) {
            return bt.css('display', 'block')
          } else {
            return bt.css('display', 'none')
          }
        });
        return bt.click(function() {
          $('body,html').animate({
            scrollTop: 0
          },
          800);
          return false
        })
      }
    }
  })(this));</script>
  
  <script src="https://tianxiawuhao.github.io/media/scripts/tocScript.js"></script>
</body>

</html>