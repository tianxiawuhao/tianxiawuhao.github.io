<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<meta name="referrer" content="never">
<meta name="keywords" content="">
<meta name="description" content="欢迎访问[tianxia]的个人博客">
<meta name="author" content="kveln">
<title>Centos7安装Harbor | tianxia</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css">
<link href="https://cdn.bootcss.com/font-awesome/5.11.2/css/all.min.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
<link
  href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'
  rel='stylesheet' type='text/css'>
<link rel="alternate" type="application/rss+xml" title="Centos7安装Harbor | tianxia » Feed"
  href="https://tianxiawuhao.github.io/atom.xml">
<link rel="stylesheet"
  href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.10/build/styles/androidstudio.min.css">
<link href="https://tianxiawuhao.github.io/styles/main.css" rel="stylesheet">
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/850552586/ericamcdn@0.1/css/live2d.css">

<script>hljs.initHighlightingOnLoad();</script>

  <meta property="og:description" content="Centos7安装Harbor" />
  <meta property="og:url" content="https://tianxiawuhao.github.io/XWPPx5pbS/" />
  <meta property="og:locale" content="zh-CN" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="tianxia" />
  <!-- <script src="../assets/styles/scripts/tocScript.js"></script> -->
</head>

<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="https://tianxiawuhao.github.io">tianxia</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
      data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
      aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        
        <li class="nav-item">
          
          <a class="nav-link" href="https://tianxiawuhao.github.io">首页</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/archives">归档</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/tags">标签</a>
          
        </li>
        
        <li class="nav-item">
          <div class="gridea-search-container">
            <form id="gridea-search-form" style="position: relative" data-update="1742729663519"
              action="/search/index.html">
              <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
              <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>
  <!-- Page Header -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="https://tianxiawuhao.github.io">tianxia</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
      data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
      aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        
        <li class="nav-item">
          
          <a class="nav-link" href="https://tianxiawuhao.github.io">首页</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/archives">归档</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/tags">标签</a>
          
        </li>
        
        <li class="nav-item">
          <div class="gridea-search-container">
            <form id="gridea-search-form" style="position: relative" data-update="1742729663519"
              action="/search/index.html">
              <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
              <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>
<header class="masthead" style="background-image: url('https://tianxiawuhao.github.io/media/images/home-bg.jpg')">
  <div class="overlay"></div>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        
          <!-- 没Title为其他页面Header -->
          
            <!-- 没Title并且有headerType为Post：文章Header -->
            <div class="post-heading">
              <span class="tags">
                
                <a href="https://tianxiawuhao.github.io/NdxF1vK3u/" class="tag">运维</a>
                
              </span>
              <h1>Centos7安装Harbor</h1>
              <span class="meta">
                Posted on
                2022-11-29，4 min read
              </span>
            </div>
          
        
      </div>
    </div>
  </div>
</header>
  <!-- Post Content -->
  <article id="post-content-article">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto post-content-container">
          
          <img class="post-feature-header-image" src="https://tianxiawuhao.github.io/post-images/XWPPx5pbS.png" alt="封面图">
          </img>
          
          <blockquote>
<p>Harbor作为docker镜像仓库，自然是要依赖于docker环境的，所以，我们在安装Harbor之前，必须要安装docker环境，同时再安装下docker-compose！</p>
</blockquote>
<p>docker与docker-compose的安装教程参考：<a href="">Docker、Docker-compose的安装</a></p>
<hr>
<h3 id="一-harbor的离线安装"><strong>一、Harbor的离线安装</strong></h3>
<p><strong>1、下载Harbor的离线安装包：</strong></p>
<p>下载地址：https://github.com/goharbor/harbor/releases</p>
<p>我下载的是当前最新版：v1.10.10</p>
<p><strong>2、上传并解压到 /usr/local/目录下：</strong></p>
<pre><code class="language-shell">[root@node1 ~]# tar -zxvf harbor-offline-installer-v1.10.10.tgz 
 
[root@node1 ~]# mv harbor /usr/local/
[root@node1 ~]# cd /usr/local/harbor/
[root@node1 harbor]# ls
common.sh  harbor.v1.10.10.tar.gz  harbor.yml  install.sh  LICENSE  prepare
</code></pre>
<p><strong>3、修改harbor的核心配置文件：</strong></p>
<pre><code class="language-shell">[root@node1 harbor]# vim harbor.yml
## 唯一必须修改项
hostname: 10.206.73.155  #如果有计划好的域名，可以直接使用域名
 
# http related config
http:
  # port for http, default is 80. If https enabled, this port will redirect to https port
  port: 80
 
# 因为我暂时不需要https访问，所以https的配置去除
#https:
  #port: 443
  #certificate: /your/certificate/path
  #private_key: /your/private/key/path
 
harbor_admin_password: Harbor12345 #需要修改
</code></pre>
<p><strong>4、检查并安装：</strong></p>
<pre><code class="language-shell"># 检查
./prepare
# 安装
./install
</code></pre>
<p>如果碰到iptable相关的error，关闭 firewalld，并重启docker服务</p>
<pre><code class="language-shell">systemctl stop firewalld
service docker restart
</code></pre>
<p><strong>5、查看、启动、停止：</strong></p>
<p>在harbor目录下使用docker-compose命令：</p>
<pre><code class="language-shell">## 查看
[root@node1 harbor]# docker-compose ps
      Name                     Command                  State                 Ports          
---------------------------------------------------------------------------------------------
harbor-core         /harbor/harbor_core              Up (healthy)                            
harbor-db           /docker-entrypoint.sh            Up (healthy)   5432/tcp                 
harbor-jobservice   /harbor/harbor_jobservice  ...   Up (healthy)                            
harbor-log          /bin/sh -c /usr/local/bin/ ...   Up (healthy)   127.0.0.1:1514-&gt;10514/tcp
harbor-portal       nginx -g daemon off;             Up (healthy)   8080/tcp                 
nginx               nginx -g daemon off;             Up (healthy)   0.0.0.0:80-&gt;8080/tcp     
redis               redis-server /etc/redis.conf     Up (healthy)   6379/tcp                 
registry            /home/harbor/entrypoint.sh       Up (healthy)   5000/tcp                 
registryctl         /home/harbor/start.sh            Up (healthy) 
 
# docker-compose stop    ## 停止
# docker-compose up -d   ## 后台启动
</code></pre>
<p><strong>6、通过yml中配置的ip+port，以及admin的账号密码访问Harbor：</strong></p>
<figure data-type="image" tabindex="1"><img src="https://tianxiawuhao.github.io/post-images/1644915125561587.png" alt="image.png" loading="lazy"></figure>
<hr>
<h3 id="补充一-内部使用harbor时只有ip端口没有域名怎么办"><strong>补充一、内部使用Harbor时，只有ip端口，没有域名怎么办？</strong></h3>
<pre><code class="language-shell">Error response from daemon: Get https://10.206.73.155/v2/: dial tcp 10.206.73.155:443: connect: connection refused
</code></pre>
<p>我们可以在docker的核心配置文件中，增加上对特定ip的允许即可：</p>
<pre><code class="language-shell">[root@master ~]# vim /etc/docker/daemon.json
{
    &quot;registry-mirrors&quot;:[
        &quot;https://otvq3lq9.mirror.aliyuncs.com&quot;
    ],
    &quot;insecure-registries&quot;:[
        &quot;10.206.73.155&quot;
    ],
    &quot;max-concurrent-downloads&quot;:10,
    &quot;log-driver&quot;:&quot;json-file&quot;,
    &quot;log-level&quot;:&quot;warn&quot;,
    &quot;log-opts&quot;:{
        &quot;max-size&quot;:&quot;50m&quot;,
        &quot;max-file&quot;:&quot;3&quot;
    },
    &quot;data-root&quot;:&quot;/var/lib/docker&quot;
}
</code></pre>
<p>重启docker守护线程和docker服务：</p>
<pre><code class="language-shell">[root@node2 ~]# systemctl daemon-reload
[root@node2 ~]# systemctl restart docker
</code></pre>

          <div class="toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li>
<ul>
<li><a href="#%E4%B8%80-harbor%E7%9A%84%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85"><strong>一、Harbor的离线安装</strong></a></li>
<li><a href="#%E8%A1%A5%E5%85%85%E4%B8%80-%E5%86%85%E9%83%A8%E4%BD%BF%E7%94%A8harbor%E6%97%B6%E5%8F%AA%E6%9C%89ip%E7%AB%AF%E5%8F%A3%E6%B2%A1%E6%9C%89%E5%9F%9F%E5%90%8D%E6%80%8E%E4%B9%88%E5%8A%9E"><strong>补充一、内部使用Harbor时，只有ip端口，没有域名怎么办？</strong></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
          <hr />
          
            <p class="prev-post">上一篇：
              <a href="https://tianxiawuhao.github.io/lhZ2-aE1I/">
                <span class="post-title">
                  Clickhouse优缺点及性能情况&rarr;
                </span>
              </a>
            </p>
          
          
          <p class="next-post">下一篇：
            <a href="https://tianxiawuhao.github.io/dpVtZ7y41/">
              <span class="post-title">
                GitLab的安装与简单使用&rarr;
              </span>
            </a>
          </p>
          
          <div class="comment" style="text-align: center;">
            

            
            
          </div>
        </div>
      </div>
    </div>
  </article>
  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <ul class="list-inline text-center">
            
            
              
            
              
            
              
            
              
            
              
            
              
            
              
              <!-- <li class="list-inline-item">
              <a href="https://tianxiawuhao.github.io/atom.xml" target="_blank">
                <span class="fa-stack fa-lg">
                  <i class="fas fa-circle fa-stack-2x"></i>
                  <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
                </span>
              </a>
              </li> -->
          </ul>
          <p class="copyright text-muted">Copyright &copy;<span>tianxia</span><br><a href="https://github.com/getgridea/gridea" class="Themeinfo">Powered by Gridea</a></p>
        </div>
      </div>
    </div>
   </footer>
  <!-- Bootstrap core JavaScript -->
  <script src="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
  <!-- <script src="https://tianxiawuhao.github.io/media/scripts/bootstrap.bundle.min.js"></script> -->
  <!-- Bootstrap core JavaScript -->
  <script src="https://cdn.jsdelivr.net/gh/Alanrk/clean-cdn@1.0/scripts/clean-blog.min.js"></script>
  <!-- <script src="https://tianxiawuhao.github.io/media/scripts/clean-blog.min.js"></script> -->
  <script src="//instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
  <style type="text/css">a.back_to_top{text-decoration:none;position:fixed;bottom:40px;right:30px;background:#f0f0f0;height:40px;width:40px;border-radius:50%;line-height:36px;font-size:18px;text-align:center;transition-duration:.5s;transition-propety:background-color;display:none}a.back_to_top span{color:#888}a.back_to_top:hover{cursor:pointer;background:#dfdfdf}a.back_to_top:hover span{color:#555}@media print,screen and(max-width:580px){.back_to_top{display:none!important}}</style>
<a id="back_to_top" href="#" class="back_to_top">
  <span>▲</span></a>
<script>$(document).ready((function(_this) {
    return function() {
      var bt;
      bt = $('#back_to_top');
      if ($(document).width() > 480) {
        $(window).scroll(function() {
          var st;
          st = $(window).scrollTop();
          if (st > 30) {
            return bt.css('display', 'block')
          } else {
            return bt.css('display', 'none')
          }
        });
        return bt.click(function() {
          $('body,html').animate({
            scrollTop: 0
          },
          800);
          return false
        })
      }
    }
  })(this));</script>
  
  <script src="https://tianxiawuhao.github.io/media/scripts/tocScript.js"></script>
</body>

</html>